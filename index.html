<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OGDEV â€“ Free Subdomains + Hosting</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%); color: white; }
    .glow { box-shadow: 0 0 40px rgba(99, 102, 241, 0.4); }
    .editor { font-family: 'Fira Code', monospace; }
  </style>
  <link href="https://cdn.jsdelivr.net/npm/firacode@6.2.0/distr/fira_code.css" rel="stylesheet">
</head>
<body class="min-h-screen">

  <div class="container mx-auto px-6 py-12 max-w-6xl">

    <!-- Header -->
    <div class="text-center mb-16">
      <h1 class="text-7xl md:text-9xl font-black bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-purple-600">
        OGDEV
      </h1>
      <p class="text-2xl mt-4 text-gray-300">Free subdomains + instant hosting</p>
    </div>

    <!-- Claim Section -->
    <div class="backdrop-blur-xl bg-white/10 rounded-3xl p-10 glow border border-white/20 mb-12">
      <div class="text-center">
        <div class="flex justify-center items-center gap-4 mb-8">
          <input id="name" placeholder="myproject" class="bg-white/10 border border-white/30 rounded-2xl px-8 py-6 text-4xl font-bold text-center text-white placeholder-gray-400 focus:border-indigo-400 outline-none w-80">
          <span class="text-4xl font-black">.ogdev.link</span>
        </div>
        <button onclick="createDomain()" class="bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white font-bold text-2xl px-16 py-6 rounded-2xl shadow-2xl">
          Claim & Launch
        </button>
      </div>
      <div id="result" class="mt-8 text-center text-xl"></div>
    </div>

    <!-- Editor (appears after domain created) -->
    <div id="editor" class="hidden">
      <div class="backdrop-blur-xl bg-white/10 rounded-3xl p-8 glow border border-white/20">
        <h2 class="text-3xl font-bold mb-6">Edit <span id="currentDomain" class="text-indigo-400"></span></h2>
        <textarea id="code" class="w-full h-96 bg-black/50 text-white p-6 rounded-xl editor text-lg" spellcheck="false"></textarea>
        <div class="mt-6 flex gap-4">
          <button onclick="saveSite()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-10 rounded-xl text-xl">Save & Deploy</button>
          <button onclick="preview()" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-4 px-10 rounded-xl text-xl">Preview</button>
        </div>
        <p class="mt-4 text-green-400" id="saveStatus"></p>
      </div>
    </div>

  </div>

  <script>
    let currentSubdomain = '';

    async function createDomain() {
      const input = document.getElementById('name');
      const name = input.value.trim().toLowerCase().replace(/[^a-z0-9-]/g, '');
      if (!name) return alert("Enter a name!");

      const res = await fetch('/api/create', {
        method: 'POST', headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({name})
      });
      const data = await res.json();

      if (data.success) {
        currentSubdomain = name;
        document.getElementById('result').innerHTML = `
          <div class="text-4xl font-black text-green-400">Live: ${data.domain}</div>
          <p class="mt-4 text-2xl">Now customize your site below</p>
        `;
        document.getElementById('editor').classList.remove('hidden');
        document.getElementById('currentDomain').textContent = data.domain;
        loadSite();
      } else {
        document.getElementById('result').innerHTML = `<p class="text-red-400 text-2xl">${data.error}</p>`;
      }
    }

    async function loadSite() {
      const res = await fetch(`/sites/${currentSubdomain}/index.html`);
      const html = res.ok ? await res.text() : `<h1>${currentSubdomain}.ogdev.link</h1><p>Welcome! Edit me.</p>`;
      document.getElementById('code').value = html;
    }

    async function saveSite() {
      const html = document.getElementById('code').value;
      const res = await fetch(`/api/upload/${currentSubdomain}`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({html})
      });
      const data = await res.json();
      document.getElementById('saveStatus').textContent = data.success ? "Deployed instantly!" : "Error";
    }

    function preview() {
      const html = document.getElementById('code').value;
      const win = window.open('', '_blank');
      win.document.write(html);
    }

    // Enter key = claim
    document.getElementById('name').addEventListener('keypress', e => e.key === 'Enter' && createDomain());
  </script>
</body>
</html>
